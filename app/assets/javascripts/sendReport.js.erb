var nextRedirect;
var previousLevelRedirect;
var sendReport = function(report) {
  var reportParams = jQuery.extend(true, {}, report);
  delete reportParams['fallbackResponse'];
  delete reportParams['onComplete'];

  jQuery.ajax({
    type: 'POST',
    timeout: 2000,
    url: report.callback,
    contentType: 'application/x-www-form-urlencoded',
    data: reportParams,
    dataType: 'json',
    beforeSend: function(xhr) {
      xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))
    },
    success: function (response) {
      reportComplete(report, response);
    },
    error: function (xhr, ajaxOptions, thrownError) {
      reportComplete(report, getFallbackResponse(report));
    }
  });
};

function getFallbackResponse(report) {
  return report.pass ? report.fallbackResponse.success : report.fallbackResponse.failure;
}

function reportComplete(report, response) {
  nextRedirect = response['redirect'];
  previousLevelRedirect = response['previous_level'];
  videoInfo = response['video_info'];
  if (report.onComplete) {
    report.onComplete(response);
  }
}
